<form id="admin-login">
    <input type="password" id="admin_pw" placeholder="Пароль" required>
    <button type="submit">Вход</button>
</form>
<ul id="app-list"></ul>
<script>
let admin_pw = '';
document.getElementById('admin-login').onsubmit = async function(e) {
    e.preventDefault();
    admin_pw = document.getElementById('admin_pw').value;
    getApps();
};

async function getApps() {
    let res = await fetch('https://thefid.pythonanywhere.com/api/applications');
    let apps = await res.json();
    let ui = '';
    apps.forEach((app, idx) => {
        ui += `<li>#${idx} <b>${app.location}</b> (${app.comment}) [${app.status}]
            <button onclick="moderate(${idx}, 'approved')">Одобрить</button>
            <button onclick="moderate(${idx}, 'declined')">Отклонить</button>
        </li>`;
    });
    document.getElementById('app-list').innerHTML = ui;
}

async function moderate(idx, status) {
    await fetch('https://thefid.pythonanywhere.com/api/applications/moderate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({idx, status, admin_password: admin_pw})
    });
    getApps();
}
</script>
